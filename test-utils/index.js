const express = require('express')
const app = express()
const orgController = require('../src/controller/org.controller/org.controller')
const orgParams = require('../src/controller/org.controller/org.middleware')
const cveIdController = require('../src/controller/cve-id.controller/cve-id.controller')
const cveIdParams = require('../src/controller/cve-id.controller/cve-id.middleware')
const cveIdControllerA = require('./reserveCaseA.non-sequential')
const cveIdControllerB = require('./reserveCaseB.non-sequential')
const cveIdControllerE = require('./reserveCaseE.non-sequential')
const cveIdControllerF = require('./reserveCaseF.non-sequential')
const cveIdControllerG = require('./reserveCaseG.non-sequential')
const middleware = require('../src/middleware/middleware')
const repos = require('./repositories')

// Body Parser Middleware
app.use(express.json()) // Allows us to handle raw JSON data
app.use(express.urlencoded({ extended: false })) // Allows us to handle url encoded data
app.use(middleware.createCtxAndReqUUID)

//* ************API Routes Setup*********** */
// --- create org --- //
app.route('/org-created-when-uuid-undefined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-uuid-null')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-uuid-defined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-roles-defined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedWhenRolesDefined() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-roles-undefined-id_quota-defined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-id_quota-undefined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-created-when-id_quota-null')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreated() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

app.route('/org-not-created-already-exists')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotCreatedAlreadyExists() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_CREATE_SINGLE)

// --- update org --- //
app.route('/org-not-updated-doesnt-exists/:shortname')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotUpdatedDoesNotExist() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_UPDATE_SINGLE)

app.route('/org-not-updated-shortname-exists/:shortname')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotUpdatedShortNameExists() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_UPDATE_SINGLE)

app.route('/org-updated-id_quota-undefined/:shortname')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotUpdatedIdQuotaUndefined() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_UPDATE_SINGLE)

app.route('/org-not-updated-no-query-parameters/:shortname')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotUpdatedNoQueryParameters() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.ORG_UPDATE_SINGLE)

// --- get org --- //
app.route('/org-cant-get-doesnt-exist/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGet() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_SINGLE)

app.route('/org-get-does-exist/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGet() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_SINGLE)

app.route('/org-get-does-exist-user-same-org/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGet() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_SINGLE)

app.route('/org-cant-get-user-not-secretariat-or-same-org/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGet() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_SINGLE)

// --- get id quota --- //
app.route('/org-id_quota-secretariat/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgSecretariatIdQuota() },
      getCveIdRepository: () => { return new repos.CveIdSecretariatIdQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

app.route('/org-id_quota-owning-org/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOwnerIdQuota() },
      getCveIdRepository: () => { return new repos.CveIdOwnerIdQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

app.route('/org-id_quota-not-owning-secretariat-org/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgNotOwnerOrSecretariatIdQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

app.route('/org-id_quota-org-does-not-exist/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgDoesNotExistIdQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

app.route('/org-id_quota-exceeds-min-quota-limit/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgExceedsMinIdQuota() },
      getCveIdRepository: () => { return new repos.CveIdExceedsMinQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

app.route('/org-id_quota-exceeds-max-quota-limit/:shortname')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgExceedsMaxIdQuota() },
      getCveIdRepository: () => { return new repos.CveIdExceedsMaxQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.ORG_ID_QUOTA)

// --- create user --- //
app.route('/user-not-created-org-does-not-exist/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCantCreateUserOrgDoesNotExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-not-created-org-does-not-match/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCantCreateUserOrgDoesNotMatch() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-org-undefined/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserCreatedOrgUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-org-null/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserCreatedOrgUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-uuid-undefined/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserCreatedOrgUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-uuid-null/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserCreatedOrgUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-uuid-defined/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserCreatedOrgUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-not-created-already-exists/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserOrgUndefined() },
      getUserRepository: () => { return new repos.UserNotCreatedAlreadyExists() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-not-created-not-secretariat-not-same-org-admin/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCantCreateUserNotSecretariatOrAdmin() },
      getUserRepository: () => { return new repos.UserNotCreated() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-secretariat-not-admin/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserWithRole() },
      getUserRepository: () => { return new repos.UserCreatedWithRole() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-not-secretariat-same-org-admin/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserAdminWithRole() },
      getUserRepository: () => { return new repos.UserCreatedAdminWithRole() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

app.route('/user-created-secretariat-same-org-admin/:shortname')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgCreatedUserWithRole() },
      getUserRepository: () => { return new repos.UserCreatedAdminWithRole() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_CREATE_SINGLE)

// --- update user --- //
app.route('/user-not-updated-org-doesnt-exist/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserNotUpdatedOrgDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-not-updated-doesnt-exist/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserNotUpdatedUserDoesntExist() },
      getUserRepository: () => { return new repos.UserNotUpdatedUserDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-not-updated-user-doesnt-exist/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserNotUpdatedOrgQueryDoesntExist() },
      getUserRepository: () => { return new repos.UserNotUpdatedOrgQueryDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-updated-adding-role-1/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserUpdatedAddingRole() },
      getUserRepository: () => { return new repos.UserUpdatedAddingRole() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-updated-adding-role-2/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserUpdatedAddingRole() },
      getUserRepository: () => { return new repos.UserUpdatedAddingRoleAlreadyExists() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-updated-removing-role-1/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserUpdatedAddingRole() },
      getUserRepository: () => { return new repos.UserUpdatedRemovingRole() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-updated-removing-role-2/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserUpdatedAddingRole() },
      getUserRepository: () => { return new repos.UserUpdatedRemovingRoleAlreadyRemoved() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/user-not-updated-no-parameters/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserNotUpdatedOrgQueryDoesntExist() },
      getUserRepository: () => { return new repos.UserNotUpdatedNoQuery() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

// --- reset secret --- //
app.route('/user-secret-not-reset-org-doesnt-exist/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretNotResetOrgDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-not-reset-user-doesnt-exist/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretNotResetUserDoesntExist() },
      getUserRepository: () => { return new repos.UserSecretNotResetUserDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-reset-sameOrg/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretResetNotAdmin() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-reset-sameUsername/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretReset() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-reset-secretariat/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretReset() },
      getUserRepository: () => { return new repos.UserSecretReset() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-reset-notSameOrgOrSecretariat/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretReset() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-reset-userIsOrgAdmin/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretReset() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-not-reset-userIsOrgAdminForDifferentOrg/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretReset() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

app.route('/user-secret-not-reset-userIsNotUserAdminOrSecretariat/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserSecretResetNotSecretariat() },
      getUserRepository: () => { return new repos.UserSecretResetNotAdmin() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_RESET_SECRET)

// --- get user --- //
app.route('/user-get-user-org-doesnt-exist/:shortname/:username')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGetUserOrgDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.USER_SINGLE)

app.route('/user-get-user-user-doesnt-exist/:shortname/:username')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGetUser() },
      getUserRepository: () => { return new repos.UserGetUserDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.USER_SINGLE)

app.route('/user-get-user/:shortname/:username')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGetUser() },
      getUserRepository: () => { return new repos.UserGetUser() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.USER_SINGLE)

// --- get cve-id --- //
app.route('/cve-id-doesnt-exist/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

app.route('/cve-id-available/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdAvailable() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

app.route('/cve-id-not-owning-org-reserved/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdNotOwningOrg() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNotOwnerOrgReserved() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

app.route('/cve-id-not-owning-org-not-reserved/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdNotOwningOrgNotReserved() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNotOwnerOrgNotReserved() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

app.route('/cve-id-owning-org/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdOwningOrg() },
      getUserRepository: () => { return new repos.UserGetCveIdOwningOrg() },
      getOrgRepository: () => { return new repos.OrgGetCveIdOwningOrg() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

app.route('/cve-id-is-secretariat/:id')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdOwningOrg() },
      getUserRepository: () => { return new repos.UserGetCveIdRequestorSecretariat() },
      getOrgRepository: () => { return new repos.OrgGetCveIdRequestorSecretariat() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_SINGLE)

// --- get filtered cve-id --- //
app.route('/cve-id-filtered-none-found')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdNoResultsWithParams() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNoCveIdsWithParams() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-state-provided')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdStateProvided() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNoCveIdsWithParams() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-no-available-cves-returned')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdNoAvailableCves() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNoCveIdsWithParams() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-cve-id-year-provided')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdYearProvided() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNoCveIdsWithParams() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-not-secretariat-no-query')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdNotSecretariatNoQuery() },
      getOrgRepository: () => { return new repos.OrgGetCveIdNoCveIdsWithParams() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-secretariat-no-query')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdSecretariatNoQuery() },
      getOrgRepository: () => { return new repos.OrgGetCveIdRequestorSecretariatNoQuery() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

app.route('/cve-id-filtered-update-user-org-request-cve-id-1/:shortname/:username')
  .put((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgUserCveIdUpdated() },
      getUserRepository: () => { return new repos.UserOrgCveIdUpdated() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parsePostParams, orgController.USER_UPDATE_SINGLE)

app.route('/cve-id-filtered-update-user-org-request-cve-id-2/:shortname/:username')
  .get((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgGetUserCveIdUpdated() },
      getUserRepository: () => { return new repos.UserGetUserCveIdUpdated() }
    }
    req.ctx.repositories = factory
    next()
  }, orgParams.parseGetParams, orgController.USER_SINGLE)

app.route('/cve-id-filtered-requested-field-not-changed')
  .get((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdGetCveIdRequestedNotChanged() },
      getOrgRepository: () => { return new repos.OrgGetCveIdRequestedNotChanged() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parseGetParams, cveIdController.CVEID_GET_FILTER)

// --- update cve-id --- //
app.route('/cve-id-modify-secretariat-cve-id-doesnt-exist/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdModifyCveIdDoesntExist() },
      getOrgRepository: () => { return new repos.OrgModifyCveIdDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

app.route('/cve-id-modify-org-doesnt-exist/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getOrgRepository: () => { return new repos.OrgModifyCveIdOrgDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

app.route('/cve-id-modify-state-query-is-reserved/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

app.route('/cve-id-modify-state-query-is-invalid/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

app.route('/cve-id-modify-org-and-state-modified/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdModifyCveIdOrgAndStateModified() },
      getOrgRepository: () => { return new repos.OrgModifyCveIdOrgAndStateModified() },
      getUserRepository: () => { return new repos.UserModifyCveIdOrgAndStateModified() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

app.route('/cve-id-modify-no-query/:id')
  .put((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdModifyCveIdNoQuery() },
      getOrgRepository: () => { return new repos.OrgModifyCveIdOrgAndStateModified() },
      getUserRepository: () => { return new repos.UserModifyCveIdOrgAndStateModified() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_UPDATE_SINGLE)

// --- reserve cve-id (default checks) --- //
app.route('/cve-id-reserve-not-owning-org')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveNotOwningOrg() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-shortname-undefined')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveShortNameUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-year-undefined')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveShortNameUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-amount-undefined')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveShortNameUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-amount-0')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveShortNameUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-batchtype-undefined')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveShortNameUndefined() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-org-doesnt-exist')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveOrgDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-amount-greater-nonsequential')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveAmountLargerThanNonSequential() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-amount-greater-id-quota')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveAmountGreaterIdQuota() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-invalid-batchtype')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveAmountLargerThanNonSequential() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

// --- reserve cve-id: priority --- //
app.route('/cve-id-reserve-year-2025-doesnt-exist')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.NullCveIdRepo() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveYearDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveYear2025RangeDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-sequential-block-priority-full')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequentialPriorityIsFull() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveSequentialPriorityIsFull() },
      getUserRepository: () => { return new repos.UserReserveSequentialPriorityIsFull() },
      getOrgRepository: () => { return new repos.OrgReserveSequentialPriorityIsFull() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-range-2021-full')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequentialPriorityIsFull() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveSequentialIsFull() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveSequentialIsFull() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-complete')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequentialPriorityIsFull() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveSequentialPriority() },
      getUserRepository: () => { return new repos.UserReserveSequentialPriorityIsFull() },
      getOrgRepository: () => { return new repos.OrgReserveSequentialPriorityIsFull() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

// --- reserve cve-id: sequential --- //
app.route('/cve-id-reserve-2025-doesnt-exist-sequential')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequentialYearDoesntExist() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveYearDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveYear2025RangeDoesntExistSequential() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-2021-full-sequential')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequentialIsFull() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveSequentialIsFull() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveYear2025RangeDoesntExistSequential() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-2020-sequential')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveSequential() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveSequential() },
      getUserRepository: () => { return new repos.UserReserveSequentialPriorityIsFull() },
      getOrgRepository: () => { return new repos.OrgReserveSequentialPriorityIsFull() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

// --- reserve cve-id-range --- //
app.route('/cve-id-range-2022/:year')
  .post((req, res, next) => {
    const factory = {
      getCveIdRangeRepository: () => { return new repos.CveIdRange2022NotExists() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RANGE_CREATE)

app.route('/cve-id-range-2022-already-exists/:year')
  .post((req, res, next) => {
    const factory = {
      getCveIdRangeRepository: () => { return new repos.CveIdRange2022Exists() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.NullOrgRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RANGE_CREATE)

// --- reserve cve-id: nonsequential --- //
app.route('/cve-id-reserve-nonsequential-2025-doesnt-exist')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReserveNonSequentialIsFull() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveYearDoesntExist() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialYearDoesntExist() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-nonsequential-3000-10-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10Ids() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccess() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccess() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccess() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-user-a-10-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseAB1() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseAB1() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseAB() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseAB() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-user-b-10-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseAB2() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseAB2() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseAB() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseAB() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-user-a-10-ids-year-full')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseAB3() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseAB3() },
      getUserRepository: () => { return new repos.repos.UserReserveNonSequentialSuccessCaseAB() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseAB() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-a-pool-incremented-reservation-fails')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseA() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseA() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseA() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseA() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdControllerA.CVEID_RESERVE)

app.route('/cve-id-reserve-b-pool-incremented-reservation-fails')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseB() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseB() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseB() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseB() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdControllerB.CVEID_RESERVE)

app.route('/cve-id-reserve-c-pool-incremented-10-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseCD() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseC() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccess() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccess() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-d-year-full')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseCD() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseD() },
      getUserRepository: () => { return new repos.NullUserRepo() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseD() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdController.CVEID_RESERVE)

app.route('/cve-id-reserve-e-pool-incremented-3-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseE() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseE() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseE() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseE() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdControllerE.CVEID_RESERVE)

app.route('/cve-id-reserve-f-year-full-after-race-condition')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseF() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialCaseF() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialCaseF() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialCaseF() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdControllerF.CVEID_RESERVE)

app.route('/cve-id-reserve-g-pool-incremented-10-ids')
  .post((req, res, next) => {
    const factory = {
      getCveIdRepository: () => { return new repos.CveIdReservePoolIncremented10IdsCaseG() },
      getCveIdRangeRepository: () => { return new repos.CveIdRangeReserveNonSequentialSuccessCaseG() },
      getUserRepository: () => { return new repos.UserReserveNonSequentialSuccessCaseG() },
      getOrgRepository: () => { return new repos.OrgReserveNonSequentialSuccessCaseG() }
    }
    req.ctx.repositories = factory
    next()
  }, cveIdParams.parsePostParams, cveIdControllerG.CVEID_RESERVE)

// --- middleware --- //

app.route('/validate-user-successful')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgValidateUserSuccess() },
      getUserRepository: () => { return new repos.UserValidateUserSuccess() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-org-doesnt-exist')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-user-not-found')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-key-incorrect')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgValidateUserSuccess() },
      getUserRepository: () => { return new repos.UserValidateUserSuccess() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-deactivated')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgValidateUserSuccess() },
      getUserRepository: () => { return new repos.UserValidateUserDeactivated() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-org-undefined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-submitter-undefined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/validate-user-secret-undefined')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.NullOrgRepo() },
      getUserRepository: () => { return new repos.NullUserRepo() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.validateUser, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-cnas-org-cna-passes')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlyCnasOrgCnaPass() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlyCnas, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-cnas-org-cna-and-secretariat-passes')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlyCnasOrgCnaSecretariatPass() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlyCnas, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-cnas-org-secretariat-passes')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlyCnasOrgSecretariatPass() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlyCnas, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-cnas-org-not-cna-rejected')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlyCnasOrgNotCnaReject() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlyCnas, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-secretariat-pass')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlySecretariatPass() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlySecretariat, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-secretariat-reject')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlySecretariatReject() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlySecretariat, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-secretariat-or-admin-reject')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlySecretariatOrAdmin() },
      getUserRepository: () => { return new repos.UserOnlySecretariatOrAdmin() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlySecretariatOrAdmin, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

app.route('/only-secretariat-or-admin-pass')
  .post((req, res, next) => {
    const factory = {
      getOrgRepository: () => { return new repos.OrgOnlySecretariatOrAdmin() },
      getUserRepository: () => { return new repos.UserOnlySecretariatOrAdmin() }
    }
    req.ctx.repositories = factory
    next()
  }, middleware.onlySecretariatOrAdmin, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

// validate json schema 5.0
app.route('/api/test/mw/schema5')
  .post(middleware.validateCveJsonSchema, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

// validate json schema 4.0
app.route('/api/test/mw/schema4')
  .post(middleware.validateCveJsonSchema, (req, res) => {
    return res.status(200).json({ message: 'Success! You have reached the target endpoint.' })
  })

//* ********API Routes Setup END*********** */

module.exports = app
